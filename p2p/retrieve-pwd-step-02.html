<!DOCTYPE html>
<html>
<head lang="zh">
  <meta charset="UTF-8">
  <title>找回密码-发财金-赚钱不等待</title>
  <link rel="stylesheet" href="css/app.css"/>
</head>
<body>
<div class="top">
  <div class="inner clearfix">
    <div class="top-left">
      <span class="txt">欢迎致电：</span>
      <span class="txt f-bold f-14">400-698-0607</span>
      <span class="txt cl-153">（服务时间：8:30 - 21:00）</span>
      <ul class="ics txt">
        <li class="item">
          <span class="ic ic-weixin"></span>
          <div class="sub-item">
            <img src="images/qrcode-weixin-public.jpg" alt=""/>
            <p>发财金公众号</p>
          </div>
        </li>
        <li class="item m">
          <a class="ic ic-weibo" href="javascript:;"></a>
        </li>
        <li class="item m">
          <span class="ic ic-mobile"></span>
          <div class="sub-item" style="display: none">
            <img src="images/qrcode-weixin-public.jpg" alt=""/>
            <p>扫一扫下载APP</p>
          </div>
        </li>
      </ul><!-- /.ics -->
      <span class="cl-153">手机app</span>
    </div><!-- /.top-left -->
    <div class="top-right">
      <ul>
        <li class="item"><a href="#">新手指引</a><span class="cl-238 ml-15 mr-15">|</span></li>
        <li class="item"><a href="#">帮助中心</a><span class="cl-238 ml-15 mr-15">|</span></li>
        <li class="item"><a href="#">登录</a><span class="cl-238 ml-15 mr-15">|</span></li>
        <li class="item"><a href="#">免费注册</a></li>
      </ul>
    </div><!-- /.top-right -->
  </div><!-- /.inner -->
</div><!-- /.top-->

<div class="nav">
  <div class="inner clearfix">
    <div class="n-left">
      <span class="logo"></span>
    </div>
    <ul class="n-right mt-10">
      <li class="item active"><a href="#">首页</a></li>
      <li class="item"><a href="#">安全保障</a></li>
      <li class="item"><a href="#">关于我们</a></li>
      <li class="item"><a href="#">我的账户</a></li>
      <li class="item sp"><a href="#">我要投资</a></li>
    </ul>
  </div><!-- /.inner -->
</div><!-- /.nav -->

  <!-- 找回密码 -->
  <div class="inner clearfix retrieve-pwd-box" style="padding: 30px 0;">
    <p class="f-24">找回登录密码</p>

    <!-- 找回密码 步骤 -->
    <div class="retrieve-pwd-steps mt-30">
      <ul class="retrieve-pwd-steps-items clearfix">
        <li class="item">
          <p><span class="steps-num-bg">1</span></p>
          <p class="mt-10"><span class="steps-text f-14 cl-153">输入用户名</span></p>
        </li>
        <li class="item curr">
          <p><span class="steps-num-bg">2</span></p>
          <p class="mt-10"><span class="steps-text f-14 cl-153">验证身份</span></p>
        </li>
        <li class="item">
          <p><span class="steps-num-bg">3</span></p>
          <p class="mt-10"><span class="steps-text f-14 cl-153">充值密码</span></p>
        </li>
        <li class="item last">
          <p><span class="steps-num-bg">4</span></p>
          <p class="mt-10"><span class="steps-text f-14 cl-153">成功</span></p>
        </li>
      </ul>
    </div>
    <!-- 找回密码 步骤 结束 -->

    <div class="mt-30">
      <table class="retrieve-pwd-table" cellspacing="20">
        <tr>
          <td width="20%" align="right"><span class="f-14">您的手机号码</span></td>
          <td class="inp-hint-base">
            <span class="f-20 f-bold">138 5885 5858</span>
          </td>
        </tr>
        <tr>
          <td align="right"><span class="f-14">输入短信验证码</span></td>
          <td class="inp-hint-base">
            <div class="clearfix">
              <input class="inp-normal-red w150 pull-left" type="text"/>
              <button class="btn-verify-codey" style="display: none;">获取验证码</button>
              <button class="btn-resendy">获取验证码</button>
            </div>
            <div class="inp-hint">
              <span class="icon-yes-16X16"></span>
              <span class="cl-204">验证码为 4 位数字</span>
              <span class="cl-red">验证码输入有误</span>
            </div>
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <button class="apply-small-btn">下一步</button>
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <span class="cl-204">若您无法使用上述方法找回，请联系客服 400-638-0808</span>
          </td>
        </tr>
      </table>
    </div>

  </div>
  <!-- 找回密码 结束 -->

<!-- footer -->
<div class="footer clearfix">
  <div class="inner">
    <div class="clearfix">
      <div class="f-left">
        <ul class="links clearfix mt-15">
          <li class="item"><a href="#">关于我们</a><span class="cl-153 ml-15 mr-15">|</span></li>
          <li class="item"><a href="#">安全保障</a><span class="cl-153 ml-15 mr-15">|</span></li>
          <li class="item"><a href="#">新手指引</a><span class="cl-153 ml-15 mr-15">|</span></li>
          <li class="item"><a href="#">帮助中心</a><span class="cl-153 ml-15 mr-15">|</span></li>
          <li class="item"><a href="#">招贤纳士</a><span class="cl-153 ml-15 mr-15">|</span></li>
          <li class="item"><a href="#">联系我们</a></li>
        </ul><!-- /.links -->
        <div class="contact clearfix mt-30">
          <p class="pull-left">
            <i class="ic ic-call"></i>
            <span class="f-24 cl-182">400-638-0808</span>
            <span class="f-12">（服务时间： 8:30 - 21:00）</span>
          </p>
          <a class="link-qq pull-left ml-20" href="#"></a>
          <!--<a class="link-weixin pull-left ml-10" href="#"></a>-->
          <a class="link-weibo pull-left ml-10" href="#"></a>
        </div>

      </div><!-- /.f-left -->

      <div class="f-right">
        <div class="pull-left">
          <div>
            <img src="images/qrcode-130X130.jpg" width="100" alt=""/>
          </div>
        </div>
        <div class="pull-left service ml-10">
          <p class="mt-15">下载手机发财金</p>
          <p class="mt-5">扫一扫，随时随地理财</p>
          <div class="mt-10 clearfix">
            <a class="btn-sp-gray pull-left" href="#"><span class="ic-ios"></span>iPhone</a>
            <a class="btn-sp-gray pull-left ml-10" href="#"><span class="ic-android"></span>Android</a>
          </div>
        </div>
      </div><!-- /.f-right -->
    </div><!-- /.clearfix -->
    <div class="clearfix others">
      <div class="pull-left">
        <a href="javascript:;" class="" target="_blank">
          <img width="93" height="33" border="0" src="images/certificate/faith1.png" alt="">
        </a>
        <a class="ml-20" href="javascript:;" target="_blank">
          <img width="93" height="33" border="0" src="images/certificate/360safe.png" alt="360网站完全认证"/>
        </a>
        <a class="ml-20" href="javascript:;" target="_blank">
          <img width="91" height="33" border="0" src="images/certificate/norton1.png" alt="">
        </a>
        <a class="ml-20" href="javascript:;" target="_blank">
          <img width="91" height="33" border="0" src="images/certificate/hy_124x47.png" alt="">
        </a>
      </div>
      <p class="copyright pull-right">©2015 杭州袋狮信息技术有限公司<span class="ml-20 mr-20">|</span><a href="#">备案号：浙ICP备14037891</a></p>
    </div>
  </div>
</div><!-- /.footer -->

<div class="bar-fixed">
  <a class="item advisor-trigger" href="javascript:;">
    <span class="ic-advisor-white ic"></span>
    <div class="txt">
      <p>理财</p>
      <p style="margin-top: 2px">顾问</p>
    </div>
  </a>
  <a class="item m" href="#">
    <span class="ic-weixin-white ic"></span>
    <div class="txt">
      <p>添加</p>
      <p style="margin-top: 2px">微信</p>
    </div>
    <div class="desc">
      <img src="images/qrcode-weixin-public.jpg" alt=""/>
      <p class="mt-5 txt-center">发财金公众号</p>
    </div><!-- /.desc -->
  </a>
  <a class="item m" href="#">
    <span class="ic-qq-white ic"></span>
    <div class="txt">
      <p>QQ</p>
      <p style="margin-top: 2px">群号</p>
    </div><!-- /.txt -->
    <div class="desc">
      <p>发财金</p>
      <p class="mt-5">投资理财QQ群</p>
      <p class="cl-red mt-5">450031321</p>
    </div><!-- /.desc -->
  </a>
  <a class="item m" href="#">
    <span class="ic-feedback-white ic"></span>
    <div class="txt">
      <p>意见</p>
      <p style="margin-top: 2px">反馈</p>
    </div>
  </a>
</div><!-- /.bar-fixed -->
<div id="modal"></div>
<!-- 手机验证  -->
<div id="pop-mobile-verify" class="pop-window">
  <div class="window-title clearfix">
    <span class="f-14">图片验证</span>
    <span class="btn-close"></span>
  </div>
  <div class="window-body">
    <div class="body-box-two">
      <table class="ml-20 w430" cellspacing="10">
        <tr>
          <td align="right">
            <span class="">验证码：</span>
          </td>
          <td>
            <div class="clearfix">
              <input class="inp-normal w120 pull-left" type="text" id="validateCode">
              <img class="verify-img ml-10 pull-left" src="<@baseUrl.home />/imageServlet" id="code-img" alt=""/>
              <button class="simple-blue-btn ml-10 mt-5 pull-left" onclick="changeCode()">看不清<br/>换一张</button>
            </div>
          </td>
          <td></td>
        </tr>
        <tr>
          <td></td>
          <td align="left">
            <span class="warning cl-red" id="validateCode-tip"></span>
          </td>
          <td></td>
        </tr>
        <tr>
          <td colspan="2" align="center">
            <button id="g-verify" class="btn-confirm">确 定</button>
          </td>
          <td></td>
        </tr>
      </table>
    </div>
  </div>
</div>
<!-- 手机验证 结束 -->
<script src="js/jquery-1.11.2.min.js"></script>
<script src="js/app.js"></script>
<script>
var phone = "${phone!}";
$(function(){
  $.modalInit("#modal");
  //发送验证码
  $(".btn-verify-codey").click(function () {
    $.ajax({
      url: "<@baseUrl.home />/validate-msg-times",
      data: {phone: phone,action:2}
    }).done(function(data) {
      if (data.success) {
        if(data.resultMsg >= 3){
          $.popup("#pop-mobile-verify");
          $("#modal").show().fadeTo(200, 0.2);
          changeCode();
        }else{
          getCheckCode("0");
        }
      }
    });
  });

  $("#g-verify").click(function(){
    var validateCode = $("#validateCode").val();
    if(validateCode.length == 0){
      $("#validateCode-tip").text("验证码不能为空");
      return false;
    }
    getCheckCode(validateCode);
  });
});
function validateSubmit(){
  var phone = "${phone!}";
  var checkCode = $("#checkCode").val();
  $.ajax({
    url:"<@baseUrl.home/>/validate-check-code",
    type:"get",
    data:{"checkCode":checkCode,"phone":phone,"action":2},
    async:false,  // 设置同步方式
    error:function(request){
      alert("Connection error");
    },
    success:function(data){
      var resultCode = data;
      switch(resultCode){
        case 0://成功
          window.location.href="<@baseUrl.home/>/login/reset-password?phone=${phone!}";
          break;
        case 1:
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("验证码为空");
          $.popup("#pop-warning-dynamic");
          break;
        case 2:
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("手机号码有误");
          $.popup("#pop-warning-dynamic");
          break;
        case 3:
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("短信验证码错误或失效");
          $.popup("#pop-warning-dynamic");
          break;
      }
      event.returnValue=false;
      return false;
    }
  });
}
function getCheckCode(validateCode){
  $.ajax({
    url:"<@baseUrl.home/>/get-check-code",
    type:"post",
    data:{mobile:"${phone!}",action:2,validateCode:validateCode},
    async:false,  // 设置同步方式
    error:function(request){
      alert("服务器故障");
    },
    success:function(data){
      var resultCode = data.resultCode;
      switch(resultCode){
        case 0://成功
          countTime();
          $("#pop-mobile-verify").hide();
          $("#modal").hide();
          break;
        case 1:
          $("#pop-mobile-verify").hide();
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("手机号码有误");
          $.popup("#pop-warning-dynamic");
          break;
        case 3:
          $("#pop-mobile-verify").hide();
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("手机号码未注册");
          $.popup("#pop-warning-dynamic");
          break;
        case 4:
          $("#pop-mobile-verify").hide();
          $("#modal").show().fadeTo(200, 0.2);
          $("#pop-warning-dynamic .msg-text").html("服务器故障");
          $.popup("#pop-warning-dynamic");
          break;
        case 6:
          $("#validateCode-tip").text("验证码错误");
          break;
        case 7:
          $("#validateCode-tip").text("手机号未填写");
          break;
      }
      changeCode();
      event.returnValue=false;
      return false;
    }
  });
}
function changeCode(){
  $('#code-img').attr("src","<@baseUrl.home />/imageServlet?date="+ new Date().getSeconds());
  event.returnValue=false;
  return;
}

function countTime(){
  var $this = $(".btn-verify-codey").hide();
  var $btn_resend = $(".btn-verify-codey").siblings(".btn-resendy").show();
  var $num = $btn_resend.find("#count-num");
  $.countdown($num.get(0), 60, 1000, function () {
    $this.html("重发验证码");
    $num.html(60);
    $btn_resend.hide();
    $this.show();
  });
}
</script>
</body>
</html>